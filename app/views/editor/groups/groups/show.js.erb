jQuery(document).ready(function($){
    var editor = '<%= escape_javascript render :partial => "grid", :locals => {:group => @group} %>';
    var editor_id = '#group_editor_<%= @group.id %>';
    if ($(editor_id).length)
      $(editor_id).replaceWith(editor);
    else
      $('#group_workspace').append(editor);
    <%= render :partial => "/editor/groups/pairs/drag_and_drop", :locals => {:group => @group} %>
    // New autocomplete (with opened groups excepted)
    $('#group_name').autocomplete({
        disabled: false,
        source: function(request, response) {
            $.getJSON('/editor/groups/groups.json', {
              group: request.term,
              except: '<%= escape_javascript @groups.join(',') %>'
            },
            function(data) {
                var groups = new Array(0);
                data.each(function(i) {
                    groups.push({ label: i.group.descriptive_name, value: i.group.id });
                });
                response(groups);
            });
        },
        select: function(event, ui) {
          $.get('/editor/groups/groups/' + ui.item.value);
          return false;
        }
    });
    $('#group_name').val('');
});
